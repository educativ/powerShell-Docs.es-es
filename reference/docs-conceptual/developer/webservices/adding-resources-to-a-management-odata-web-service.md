---
title: Agregar recursos a un servicio Web Management OData | Microsoft Docs
ms.custom: ''
ms.date: 09/13/2016
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: e620bf6d-76be-47b0-a7a8-f43418f30c60
caps.latest.revision: 6
ms.openlocfilehash: b81a32b867795ae51c3f5308c2f82c31ed2747fa
ms.sourcegitcommit: 52a67bcd9d7bf3e8600ea4302d1fa8970ff9c998
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/15/2019
ms.locfileid: "72359824"
---
# <a name="adding-resources-to-a-management-odata-web-service"></a><span data-ttu-id="72bea-102">Adición de recursos a un servicio web de Management OData</span><span class="sxs-lookup"><span data-stu-id="72bea-102">Adding Resources to a Management OData Web Service</span></span>

<span data-ttu-id="72bea-103">En este ejemplo se muestra cómo agregar un recurso a un servicio Web de administración de OData existente mediante el diseñador de esquemas de Management OData.</span><span class="sxs-lookup"><span data-stu-id="72bea-103">This example demonstrates how to add a resource to an existing Management OData web service by using the Management OData Schema Designer.</span></span> <span data-ttu-id="72bea-104">En el ejemplo [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) se crea un servicio Web que expone el proceso y los recursos del servidor.</span><span class="sxs-lookup"><span data-stu-id="72bea-104">The [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample creates a web service that exposes the Process and Server resources.</span></span> <span data-ttu-id="72bea-105">En este ejemplo, agregará un recurso de máquina virtual (VM) al servicio Web.</span><span class="sxs-lookup"><span data-stu-id="72bea-105">In this example, you will add a Virtual Machine (VM) resource to the web service.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="72bea-106">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="72bea-106">Prerequisites</span></span>

<span data-ttu-id="72bea-107">En este tema se supone que ha descargado e instalado el ejemplo [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) tal como se describe en [creación de un servicio Web de Windows PowerShell](./creating-a-management-odata-web-service.md)y que ha descargado e instalado el [Diseñador de esquemas OData de administración](https://marketplace.visualstudio.com/items?itemName=jlisc0.ManagementODataSchemaDesigner).</span><span class="sxs-lookup"><span data-stu-id="72bea-107">This topic assumes that you have downloaded and installed the [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample as described in [Creating a Windows PowerShell Web Service](./creating-a-management-odata-web-service.md), and that you have downloaded and installed the [Management OData Schema Designer](https://marketplace.visualstudio.com/items?itemName=jlisc0.ManagementODataSchemaDesigner).</span></span> <span data-ttu-id="72bea-108">En este tema también se supone que tiene el módulo de Windows PowerShell de Hyper-V instalado en el equipo en el que configuró el punto de conexión de oData de administración.</span><span class="sxs-lookup"><span data-stu-id="72bea-108">This topic also assumes that you have the Hyper-V Windows PowerShell module installed on the computer where you set up the Management Odata endpoint.</span></span>

## <a name="adding-vm-as-a-resource-to-the-web-service"></a><span data-ttu-id="72bea-109">Agregar una máquina virtual como un recurso al servicio Web</span><span class="sxs-lookup"><span data-stu-id="72bea-109">Adding VM as a Resource to the Web Service</span></span>

<span data-ttu-id="72bea-110">El primer paso consiste en importar el esquema del extremo de administración de OData existente en el diseñador de esquemas.</span><span class="sxs-lookup"><span data-stu-id="72bea-110">The first step is to import the schema from the existing Management OData endpoint into the schema designer.</span></span> <span data-ttu-id="72bea-111">En el procedimiento siguiente se describe cómo hacerlo.</span><span class="sxs-lookup"><span data-stu-id="72bea-111">The following procedure describes how to do that.</span></span>

#### <a name="importing-an-existing-schema-into-the-schema-designer"></a><span data-ttu-id="72bea-112">Importar un esquema existente en el diseñador de esquemas</span><span class="sxs-lookup"><span data-stu-id="72bea-112">Importing an existing schema into the schema designer</span></span>

1. <span data-ttu-id="72bea-113">Abra el diseñador de esquemas OData de administración.</span><span class="sxs-lookup"><span data-stu-id="72bea-113">Open the Management OData Schema Designer.</span></span>

2. <span data-ttu-id="72bea-114">En el menú **archivo** , seleccione **archivo** ; **Nuevo** ; **Archivo**.</span><span class="sxs-lookup"><span data-stu-id="72bea-114">From the **File** menu, select **File** ; **New** ; **File**.</span></span> <span data-ttu-id="72bea-115">Aparecerá el cuadro de diálogo **nuevo archivo** .</span><span class="sxs-lookup"><span data-stu-id="72bea-115">The **New File** dialog appears.</span></span>

3. <span data-ttu-id="72bea-116">Haga clic en **Management OData Model**y, a continuación, haga clic en **abrir**.</span><span class="sxs-lookup"><span data-stu-id="72bea-116">Click **Management OData Model**, and then click **Open**.</span></span>

4. <span data-ttu-id="72bea-117">Haga clic con el botón derecho en la ventana principal y haga clic en **archivo de esquema** ; **Importar**.</span><span class="sxs-lookup"><span data-stu-id="72bea-117">Right-click in the main window, and click **Schema file** ; **Import**.</span></span> <span data-ttu-id="72bea-118">Aparece el cuadro de diálogo **abrir** .</span><span class="sxs-lookup"><span data-stu-id="72bea-118">The **Open** dialog appears.</span></span>

5. <span data-ttu-id="72bea-119">Navegue hasta la carpeta donde configuró el servicio Web de Management OData para el ejemplo [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) .</span><span class="sxs-lookup"><span data-stu-id="72bea-119">Navigate to the folder where you set up the Management OData web service for the [PswsRoleBasedPlugins](https://code.msdn.microsoft.com:443/windowsdesktop/PswsRoleBasedPlugins-9c79b75a) sample.</span></span> <span data-ttu-id="72bea-120">Si usó el script de Windows PowerShell que se proporciona con ese ejemplo para configurar el punto de conexión sin modificar el script, esa carpeta es **C:\inetpub\wwwroot\Modata**.</span><span class="sxs-lookup"><span data-stu-id="72bea-120">If you used the Windows PowerShell script provided with that sample to set up the endpoint without modifying the script, that folder is **C:\inetpub\wwwroot\Modata**.</span></span> <span data-ttu-id="72bea-121">Seleccione Schema. mof y haga clic en **abrir**.</span><span class="sxs-lookup"><span data-stu-id="72bea-121">Select Schema.mof, and click **Open**.</span></span>

   <span data-ttu-id="72bea-122">En este momento, abra los archivos Schema. mof y Schema. XML en un editor de texto y observe que contienen asignaciones para los recursos de proceso y servicio.</span><span class="sxs-lookup"><span data-stu-id="72bea-122">At this point, open the Schema.mof and Schema.xml files in a text editor, and notice that they contain mappings for the Process and Service resources.</span></span> <span data-ttu-id="72bea-123">El archivo Schema. mof usa el estándar de objetos administrados (MOF) del [equipo de administración distribuida](https://www.dmtf.org/) (DTMF).</span><span class="sxs-lookup"><span data-stu-id="72bea-123">The Schema.mof file uses [Distributed Management  Task Force](https://www.dmtf.org/) (DTMF) Managed Object (MOF) standard.</span></span> <span data-ttu-id="72bea-124">El archivo Schema. xml utiliza un esquema XML que se describe en el [esquema de asignación de recursos](./resource-mapping-schema.md).</span><span class="sxs-lookup"><span data-stu-id="72bea-124">The schema.xml file uses an XML schema that is described in [Resource Mapping Schema](./resource-mapping-schema.md).</span></span>

   <span data-ttu-id="72bea-125">En el procedimiento siguiente se describe cómo importar los cmdlets de Hyper-V en al modelo de esquema.</span><span class="sxs-lookup"><span data-stu-id="72bea-125">The following procedure describes how to import Hyper-V cmdlets in to the schema model.</span></span>

#### <a name="importing-cmdlets-into-the-schema"></a><span data-ttu-id="72bea-126">Importación de cmdlets en el esquema</span><span class="sxs-lookup"><span data-stu-id="72bea-126">Importing cmdlets into the schema</span></span>

1. <span data-ttu-id="72bea-127">Haga clic con el botón secundario en un área en blanco de la ventana del diseñador de esquemas y haga clic en **importar cmdlets**.</span><span class="sxs-lookup"><span data-stu-id="72bea-127">Right-click on a blank area of the schema designer window, and click **Import Cmdlets**.</span></span> <span data-ttu-id="72bea-128">Aparece el cuadro de diálogo **Asistente para importar cmdlets** .</span><span class="sxs-lookup"><span data-stu-id="72bea-128">The **Cmdlet Import Wizard** dialog appears.</span></span>

2. <span data-ttu-id="72bea-129">Asegúrese de que el **equipo local** está seleccionado y haga clic en **siguiente**.</span><span class="sxs-lookup"><span data-stu-id="72bea-129">Make sure **Local Computer** is selected, and click **Next**.</span></span>

3. <span data-ttu-id="72bea-130">Asegúrese de que está seleccionado módulos de Windows PowerShell instalados y seleccione Hyper-V en la lista desplegable.</span><span class="sxs-lookup"><span data-stu-id="72bea-130">Make sure that Installed Windows PowerShell Modules is selected, and select Hyper-V from the drop-down list.</span></span> <span data-ttu-id="72bea-131">Haga clic en **siguiente**.</span><span class="sxs-lookup"><span data-stu-id="72bea-131">click **Next**.</span></span> <span data-ttu-id="72bea-132">Haga clic en **Siguiente**.</span><span class="sxs-lookup"><span data-stu-id="72bea-132">Click **Next**.</span></span>

4. <span data-ttu-id="72bea-133">En la lista de **nombres de cmdlet** , seleccione **VM**.</span><span class="sxs-lookup"><span data-stu-id="72bea-133">In the **Cmdlet Noun** list, select **VM**.</span></span> <span data-ttu-id="72bea-134">Haga clic en **Siguiente**.</span><span class="sxs-lookup"><span data-stu-id="72bea-134">Click **Next**</span></span>

5. <span data-ttu-id="72bea-135">En este ejemplo, solo se enlazarán los comandos GET y DELETE con cmdlets.</span><span class="sxs-lookup"><span data-stu-id="72bea-135">For this example, we will bind only the Get and Delete commands with cmdlets.</span></span> <span data-ttu-id="72bea-136">Desactive las casillas **crear** y **Actualizar** y asegúrese de que estén activadas las casillas **obtener** y **eliminar** .</span><span class="sxs-lookup"><span data-stu-id="72bea-136">Clear the **CREATE** and **UPDATE** checkboxes, and make sure the **GET** and **DELETE** checkboxes are checked.</span></span> <span data-ttu-id="72bea-137">Asegúrese de que se ha seleccionado el cmdlet `Get-VM` para **Get**y el cmdlet `Remove-VM` para **eliminar**.</span><span class="sxs-lookup"><span data-stu-id="72bea-137">Make sure that the `Get-VM` cmdlet is selected for **GET**, and the `Remove-VM` cmdlet is selected for **DELETE**.</span></span>

6. <span data-ttu-id="72bea-138">Dado que los metadatos de los cmdlets de máquina virtual no especifican un tipo de salida, deberá ejecutar el cmdlet para especificar el tipo de salida.</span><span class="sxs-lookup"><span data-stu-id="72bea-138">Because the metadata for the VM cmdlets does not specify an output type, you will need to run the cmdlet to specify the output type.</span></span> <span data-ttu-id="72bea-139">Seleccione **proporcionar el tipo de salida** y haga clic en **Ejecutar cmdlet**.</span><span class="sxs-lookup"><span data-stu-id="72bea-139">Select **Provide output type** and click **Run cmdlet**.</span></span> <span data-ttu-id="72bea-140">Aparece el cuadro de diálogo **Ejecutar cmdlet** .</span><span class="sxs-lookup"><span data-stu-id="72bea-140">The **Run Cmdlet** dialog appears.</span></span> <span data-ttu-id="72bea-141">Haga clic en **Ejecutar**.</span><span class="sxs-lookup"><span data-stu-id="72bea-141">Click **Run**.</span></span> <span data-ttu-id="72bea-142">El cuadro **tipo CLR** se rellena con el tipo `VirtualMachine`.</span><span class="sxs-lookup"><span data-stu-id="72bea-142">The **CLR Type** box is populated with the `VirtualMachine` type.</span></span> <span data-ttu-id="72bea-143">Haga clic en **Aceptar**y, a continuación, en **siguiente**.</span><span class="sxs-lookup"><span data-stu-id="72bea-143">Click **OK**, then click **Next**.</span></span>

7. <span data-ttu-id="72bea-144">De forma predeterminada, se seleccionan todas las propiedades del objeto VirtualMachine.</span><span class="sxs-lookup"><span data-stu-id="72bea-144">By default, all of the properties of the VirtualMachine object are selected.</span></span> <span data-ttu-id="72bea-145">Puede borrar cualquier propiedad que no desee como parte de los datos que se devuelven al solicitar este recurso desde el servicio Web.</span><span class="sxs-lookup"><span data-stu-id="72bea-145">You can clear any properties that you do not want as part of the data returned when you request this resource from the web service.</span></span> <span data-ttu-id="72bea-146">Haga clic en **Siguiente**.</span><span class="sxs-lookup"><span data-stu-id="72bea-146">Click **Next**.</span></span>

8. <span data-ttu-id="72bea-147">Debe seleccionar al menos una propiedad para usarla como clave.</span><span class="sxs-lookup"><span data-stu-id="72bea-147">You must select at least one property to be used as a key.</span></span> <span data-ttu-id="72bea-148">Seleccione **nombre** en la lista y haga clic en **siguiente**.</span><span class="sxs-lookup"><span data-stu-id="72bea-148">Select **Name** in the list, and click **Next**.</span></span>

9. <span data-ttu-id="72bea-149">La siguiente ventana permite asignar propiedades del recurso de OData de administración a las propiedades de los cmdlets subyacentes.</span><span class="sxs-lookup"><span data-stu-id="72bea-149">The next window allows you to map properties of the Management OData resource to properties of the underlying cmdlets.</span></span> <span data-ttu-id="72bea-150">De forma predeterminada, el asistente asigna propiedades con nombres idénticos.</span><span class="sxs-lookup"><span data-stu-id="72bea-150">The wizard maps properties with identical names by default.</span></span> <span data-ttu-id="72bea-151">Por ejemplo, la propiedad `ComputerName` del recurso se asigna a la propiedad `ComputerName` de los cmdlets.</span><span class="sxs-lookup"><span data-stu-id="72bea-151">For example, the `ComputerName` property of the resource is mapped to the `ComputerName` property of the cmdlets.</span></span>  <span data-ttu-id="72bea-152">Esto le permite especificar la propiedad `ComputerName` en una solicitud al servicio Web y hacer que el valor que especifique se pase al cmdlet `Get-VM`.</span><span class="sxs-lookup"><span data-stu-id="72bea-152">This allows you to specify the `ComputerName` property in a request to the web service, and have the value you specify be passed to the `Get-VM` cmdlet.</span></span> <span data-ttu-id="72bea-153">también se asignan de forma predeterminada `Id` y `Name`.</span><span class="sxs-lookup"><span data-stu-id="72bea-153">`Id` and `Name` are also mapped by default.</span></span>

   10. <span data-ttu-id="72bea-154">Haga clic en **siguiente**y, a continuación, en **Finalizar**.</span><span class="sxs-lookup"><span data-stu-id="72bea-154">Click **Next**, then click **Finish**.</span></span>

       <span data-ttu-id="72bea-155">El recurso de VM aparece ahora en la ventana del diseñador de esquemas.</span><span class="sxs-lookup"><span data-stu-id="72bea-155">The VM resource now appears in the schema designer window.</span></span> <span data-ttu-id="72bea-156">Puede examinar las propiedades y las operaciones asociadas al recurso.</span><span class="sxs-lookup"><span data-stu-id="72bea-156">You can examine the properties and operations associated with the resource.</span></span> <span data-ttu-id="72bea-157">A continuación, exportará los archivos de esquema actualizados en el directorio virtual para el servicio Web.</span><span class="sxs-lookup"><span data-stu-id="72bea-157">Next, you will export the updated schema files into the virtual directory for the web service.</span></span>

#### <a name="exporting-schema-files-from-the-schema-designer"></a><span data-ttu-id="72bea-158">Exportar archivos de esquema desde el diseñador de esquemas</span><span class="sxs-lookup"><span data-stu-id="72bea-158">Exporting schema files from the schema designer</span></span>

1. <span data-ttu-id="72bea-159">Haga clic con el botón secundario en un área en blanco de la ventana del diseñador de esquemas y haga clic en **archivo de esquema** ; **Exportar**.</span><span class="sxs-lookup"><span data-stu-id="72bea-159">Right-click on a blank area of the schema designer window, and click **Schema file** ; **Export**.</span></span> <span data-ttu-id="72bea-160">Aparece el cuadro de diálogo **Guardar como** .</span><span class="sxs-lookup"><span data-stu-id="72bea-160">The **Save As** dialog appears.</span></span>

2. <span data-ttu-id="72bea-161">Navegue al mismo directorio desde el que importó el archivo MOF.</span><span class="sxs-lookup"><span data-stu-id="72bea-161">Navigate to the same directory from where you imported the MOF file.</span></span> <span data-ttu-id="72bea-162">Asigne al archivo el mismo nombre que el archivo MOF original (Schema. mof de forma predeterminada) y haga clic en **Guardar**.</span><span class="sxs-lookup"><span data-stu-id="72bea-162">Name the file the same as the original MOF file (Schema.mof by default), and click **Save**.</span></span> <span data-ttu-id="72bea-163">Confirme que desea sobrescribir el archivo existente.</span><span class="sxs-lookup"><span data-stu-id="72bea-163">Confirm that you want to overwrite the existing file.</span></span>

   <span data-ttu-id="72bea-164">Aunque no se indica explícitamente en el cuadro de diálogo **Guardar como** , reemplaza los archivos Schema. mof y Schema. Xml.</span><span class="sxs-lookup"><span data-stu-id="72bea-164">Although it is not explicitly stated in the **Save As** dialog, this replaces both the Schema.mof and Schema.xml files.</span></span>

## <a name="next-steps"></a><span data-ttu-id="72bea-165">Pasos a seguir</span><span class="sxs-lookup"><span data-stu-id="72bea-165">Next Steps</span></span>

<span data-ttu-id="72bea-166">Antes de tener acceso al nuevo recurso de máquina virtual desde el servicio Web Management OData, debe actualizar el archivo RbacConfiguration. XML para permitir el acceso al módulo de Windows PowerShell de Hyper-V, tal como se describe en configuración de la [autorización basada en roles](./configuring-role-based-authorization.md), y también es necesario reiniciar el servicio Web.</span><span class="sxs-lookup"><span data-stu-id="72bea-166">Before you access the new VM resource from the Management OData web service, you must update the RbacConfiguration.xml file to allow access to the Hyper-V Windows PowerShell module as described in [Configuring Role-based Authorization](./configuring-role-based-authorization.md), and you will also need to restart the web service.</span></span>